from django.http import JsonResponse
from django.shortcuts import render
from rest_framework.parsers import JSONParser
from rest_framework.views import APIView
from rest_framework.response import Response
from diploma_api import settings
from .utils import get_ee_classification


def map_view(request):
    context = {
        'google_maps_api_key': settings.GOOGLE_MAPS_API_KEY
    }
    return render(request, 'index.html', context)


class AnalyzeArea(APIView):
    def post(self, request):
        try:
            data = JSONParser().parse(request)
            coordinates = data.get('coordinates')
            if not coordinates:
                return JsonResponse({'error': 'Error getting polygon data from request'}, status=500)
            if len(coordinates) < 3:
                return JsonResponse({'error': 'Error - polygon must consist of at least 3 interconnected points'},
                                    status=500)
            for i in range(10000):
                print(i)
            # res = get_ee_classification(coordinates)
            # return JsonResponse({'coordinates': coordinates, 'area': res[0], 'crop': res[1], 'f': res[2], 'e': res[3]}, status=200)

            resp = {
                "coordinates": [
                    [
                        26.24445693725594,
                        50.337338508055886
                    ],
                    [
                        26.25441329711922,
                        50.33054495090971
                    ],
                    [
                        26.27612846130379,
                        50.337228942261085
                    ],
                    [
                        26.25921981567391,
                        50.34451451726629
                    ]
                ],
                "area": [
                    {
                        "area": 1.0701997029485502,
                        "percentage": 61.229021995728495,
                        "id": 40
                    },
                    {
                        "area": 0.5832946366020498,
                        "percentage": 33.371865116481295,
                        "id": 114
                    },
                    {
                        "area": 0.038863613249056954,
                        "percentage": 2.2234925163069232,
                        "id": 115
                    },
                    {
                        "area": 0.032156860259860164,
                        "percentage": 1.8397810228687779,
                        "id": 126
                    },
                    {
                        "area": 0.016313908615112303,
                        "percentage": 0.9333628730029998,
                        "id": 125
                    },
                    {
                        "area": 0.012235872116088868,
                        "percentage": 0.7000473658035986,
                        "id": 116
                    },
                    {
                        "area": 0.000847139091282265,
                        "percentage": 0.048467120585677155,
                        "id": 124
                    }
                ],
                "crop": [
                    [
                        26.25101839018272,
                        50.34018693916457
                    ],
                    [
                        26.25281502075096,
                        50.34018693916457
                    ],
                    [
                        26.25281502075096,
                        50.339040265369256
                    ],
                    [
                        26.255509966603316,
                        50.339040265369256
                    ],
                    [
                        26.255509966603316,
                        50.33846691810055
                    ],
                    [
                        26.256408281887435,
                        50.33846691810055
                    ],
                    [
                        26.256408281887435,
                        50.33617345979257
                    ],
                    [
                        26.258204912455675,
                        50.33617345979257
                    ],
                    [
                        26.258204912455675,
                        50.33560007792076
                    ],
                    [
                        26.259103227739793,
                        50.33560007792076
                    ],
                    [
                        26.259103227739793,
                        50.33445329340809
                    ],
                    [
                        26.262696488876273,
                        50.33445329340809
                    ],
                    [
                        26.262696488876273,
                        50.333019773834266
                    ],
                    [
                        26.263145646518332,
                        50.333019773834266
                    ],
                    [
                        26.263145646518332,
                        50.33330648120934
                    ],
                    [
                        26.26404396180245,
                        50.33330648120934
                    ],
                    [
                        26.26404396180245,
                        50.33359318685965
                    ],
                    [
                        26.264942277086572,
                        50.33359318685965
                    ],
                    [
                        26.264942277086572,
                        50.33387989076723
                    ],
                    [
                        26.26584059237069,
                        50.33387989076723
                    ],
                    [
                        26.26584059237069,
                        50.33416659295004
                    ],
                    [
                        26.26673890765481,
                        50.33416659295004
                    ],
                    [
                        26.26673890765481,
                        50.33445329340809
                    ],
                    [
                        26.26808638058099,
                        50.33445329340809
                    ],
                    [
                        26.26808638058099,
                        50.33473999213239
                    ],
                    [
                        26.268984695865107,
                        50.33473999213239
                    ],
                    [
                        26.268984695865107,
                        50.33502668912294
                    ],
                    [
                        26.26988301114923,
                        50.33502668912294
                    ],
                    [
                        26.26988301114923,
                        50.335313384388726
                    ],
                    [
                        26.270781326433347,
                        50.335313384388726
                    ],
                    [
                        26.270781326433347,
                        50.33560007792076
                    ],
                    [
                        26.271679641717466,
                        50.33560007792076
                    ],
                    [
                        26.271679641717466,
                        50.335886769719046
                    ],
                    [
                        26.272577957001587,
                        50.335886769719046
                    ],
                    [
                        26.272577957001587,
                        50.33617345979257
                    ],
                    [
                        26.273476272285706,
                        50.33617345979257
                    ],
                    [
                        26.273476272285706,
                        50.33646014814133
                    ],
                    [
                        26.274374587569827,
                        50.33646014814133
                    ],
                    [
                        26.274374587569827,
                        50.33674683474735
                    ],
                    [
                        26.275272902853946,
                        50.33674683474735
                    ],
                    [
                        26.275272902853946,
                        50.33703351963759
                    ],
                    [
                        26.275722060496005,
                        50.33703351963759
                    ],
                    [
                        26.275722060496005,
                        50.33760688420785
                    ],
                    [
                        26.274823745211886,
                        50.33760688420785
                    ],
                    [
                        26.274823745211886,
                        50.33789356390584
                    ],
                    [
                        26.274374587569827,
                        50.33789356390584
                    ],
                    [
                        26.274374587569827,
                        50.33818024186108
                    ],
                    [
                        26.273476272285706,
                        50.33818024186108
                    ],
                    [
                        26.273476272285706,
                        50.33846691810055
                    ],
                    [
                        26.273027114643646,
                        50.33846691810055
                    ],
                    [
                        26.273027114643646,
                        50.338753592597286
                    ],
                    [
                        26.27212879935953,
                        50.338753592597286
                    ],
                    [
                        26.27212879935953,
                        50.339040265369256
                    ],
                    [
                        26.271679641717466,
                        50.339040265369256
                    ],
                    [
                        26.271679641717466,
                        50.33932693641646
                    ],
                    [
                        26.270781326433347,
                        50.33932693641646
                    ],
                    [
                        26.270781326433347,
                        50.339613605729916
                    ],
                    [
                        26.27033216879129,
                        50.339613605729916
                    ],
                    [
                        26.27033216879129,
                        50.339900273309624
                    ],
                    [
                        26.26943385350717,
                        50.339900273309624
                    ],
                    [
                        26.26943385350717,
                        50.34018693916457
                    ],
                    [
                        26.268984695865107,
                        50.34018693916457
                    ],
                    [
                        26.268984695865107,
                        50.34047360328576
                    ],
                    [
                        26.26808638058099,
                        50.34047360328576
                    ],
                    [
                        26.26808638058099,
                        50.340760265673204
                    ],
                    [
                        26.26763722293893,
                        50.340760265673204
                    ],
                    [
                        26.26763722293893,
                        50.341046926335885
                    ],
                    [
                        26.26673890765481,
                        50.341046926335885
                    ],
                    [
                        26.26673890765481,
                        50.34133358526482
                    ],
                    [
                        26.26628975001275,
                        50.34133358526482
                    ],
                    [
                        26.26628975001275,
                        50.341620242468984
                    ],
                    [
                        26.26539143472863,
                        50.341620242468984
                    ],
                    [
                        26.26539143472863,
                        50.3419068979394
                    ],
                    [
                        26.264942277086572,
                        50.3419068979394
                    ],
                    [
                        26.264942277086572,
                        50.34219355168506
                    ],
                    [
                        26.26404396180245,
                        50.34219355168506
                    ],
                    [
                        26.26404396180245,
                        50.34248020369696
                    ],
                    [
                        26.26359480416039,
                        50.34248020369696
                    ],
                    [
                        26.26359480416039,
                        50.342766853975114
                    ],
                    [
                        26.262696488876273,
                        50.342766853975114
                    ],
                    [
                        26.262696488876273,
                        50.343053502528505
                    ],
                    [
                        26.262247331234214,
                        50.343053502528505
                    ],
                    [
                        26.262247331234214,
                        50.343340149357125
                    ],
                    [
                        26.261349015950092,
                        50.343340149357125
                    ],
                    [
                        26.261349015950092,
                        50.34362679444302
                    ],
                    [
                        26.260899858308033,
                        50.34362679444302
                    ],
                    [
                        26.260899858308033,
                        50.34420007944051
                    ],
                    [
                        26.257755754813616,
                        50.34420007944051
                    ],
                    [
                        26.257755754813616,
                        50.34391343780415
                    ],
                    [
                        26.258204912455675,
                        50.34391343780415
                    ],
                    [
                        26.258204912455675,
                        50.34362679444302
                    ],
                    [
                        26.257755754813616,
                        50.34362679444302
                    ],
                    [
                        26.257755754813616,
                        50.343340149357125
                    ],
                    [
                        26.256857439529494,
                        50.343340149357125
                    ],
                    [
                        26.256857439529494,
                        50.343053502528505
                    ],
                    [
                        26.256408281887435,
                        50.343053502528505
                    ],
                    [
                        26.256408281887435,
                        50.342766853975114
                    ],
                    [
                        26.255959124245376,
                        50.342766853975114
                    ],
                    [
                        26.255959124245376,
                        50.34248020369696
                    ],
                    [
                        26.255060808961257,
                        50.34248020369696
                    ],
                    [
                        26.255060808961257,
                        50.34219355168506
                    ],
                    [
                        26.254611651319195,
                        50.34219355168506
                    ],
                    [
                        26.254611651319195,
                        50.3419068979394
                    ],
                    [
                        26.254162493677136,
                        50.3419068979394
                    ],
                    [
                        26.254162493677136,
                        50.341620242468984
                    ],
                    [
                        26.253264178393017,
                        50.341620242468984
                    ],
                    [
                        26.253264178393017,
                        50.34133358526482
                    ],
                    [
                        26.25281502075096,
                        50.34133358526482
                    ],
                    [
                        26.25281502075096,
                        50.341046926335885
                    ],
                    [
                        26.2523658631089,
                        50.341046926335885
                    ],
                    [
                        26.2523658631089,
                        50.340760265673204
                    ],
                    [
                        26.251467547824777,
                        50.340760265673204
                    ],
                    [
                        26.251467547824777,
                        50.34047360328576
                    ],
                    [
                        26.25101839018272,
                        50.34047360328576
                    ],
                    [
                        26.25101839018272,
                        50.34018693916457
                    ]
                ]
            }
            return JsonResponse(resp, status=200)

            # return JsonResponse({'error': 'Error analysing polygon data'}, status=500)
        except Exception as e:
            return JsonResponse({'error': 'Error analysing polygon data' + str(e)}, status=500)
